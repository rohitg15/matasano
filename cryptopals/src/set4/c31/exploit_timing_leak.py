import sys
import socket
import time

if __name__ == "__main__":
    argc = len(sys.argv)
    if argc != 4:
        print "usage:%s host port message['file=filename']" % (sys.argv[0])
        exit(-1)
    host = sys.argv[1]
    port = int(sys.argv[2])
    message = sys.argv[3]
    
    # hmac of the message 'foo' encrypted with key 'bar' is 46b4ec586117154dacd49d664e5d63fdc88efb51
    mac_len = 20
    prefix = ''
    table = {}
    for byte in range(256):
        guess = chr(byte) + 19 * 'a'
        count = 0.0
        for times in range(2700):
            s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            start = time.time()
            s.connect((host, port))
            nbytes = s.send(message + '&signature=' + guess.encode('hex'))
            response = s.recv(1024)
            end = time.time()
            s.close()
            count = count + (end - start)
        table[byte] = count * 1.0
    
    sorted_table = sorted(table, key=lambda k : table[k])
    print sorted_table
    for key, value in table.items():
        print "%d : %f" % (key, value)    
    #print "sent message:%s with %d bytes" % (message, nbytes)
    #print "received %s from server" % (response)
    #s.close()
    exit(0)